  <html>
  <head>
    <title>Demo - Covnert JSON to CSV</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript" src="json2.js"></script>

    <script type="text/javascript">
    var b = '';
          // JSON to CSV Converter
          function ConvertToCSV(objArray) {
            var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
            var str = '';

            for (var i = 0; i < array.length; i++) {
              var line = '';
              for (var index in array[i]) {
                if (line != '') line += ','

                  line += array[i][index];
              }

              str += line + '\r\n';

            }

            return str;
          }

          // Example
          $(document).ready(function () {
         var loc = [];  //object

             //console.log(typeof(loc));
             
             var increment = (function () {
              var n = -10;
              return function () {
                n += 10;
                return n;
              }
            }());

             (function store(){
              var stores = [];
            //for(x=0; x<=5050:x+10){
              var  x = increment();   
              // console.log(x);
              $.ajax({url: 'https://www.paxvapor.com/locator/index/getstores/',
                data: {lat:32, lng:118, count: x},
                success: function(result){

                  if(x >5050){ 
                    download(b);
                  }
                  else{
                    var loc = result;
  showdata(loc); //callback printing all records
  store();
}



}});


            }());

              // Create Object
              var items = [
              { name: "Item 1", color: "Green", size: "X-Large" },
              { name: "Item 2", color: "Green", size: "X-Large" },
              { name: "Item 3", color: "Green", size: "X-Large" }];

              // Convert Object to JSON
              var jsonObject = JSON.stringify(loc);

              // Display JSON
              $('#json').text(loc);

              // Convert JSON to CSV & Display CSV

            });

  function showdata(loc){
    var a = ConvertToCSV(loc);
  //console.log(typeof(a));

  b =  b + a;
  //$('#csv').text(b);

}
//download(b);


function download(csv){
  a=document.createElement('a');
a.textContent='download';
a.download="myFileName.csv";
a.href='data:text/csv;charset=utf-8,'+escape(csv);
document.body.appendChild(a);
      }
      </script>
    </head>
    <body>
      <h1>
        JSON</h1>
        <pre id="json"></pre>
        <h1>
          CSV</h1>
          <pre id="csv"></pre>
        </body>
        </html>