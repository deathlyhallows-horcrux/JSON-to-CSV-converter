<html>
<head>
    <title>Demo - Covnert JSON to CSV</title>
    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript" src="json2.js"></script>

    <script type="text/javascript">
        // JSON to CSV Converter
    function Json2CSV(objArray)
{
var 
getKeys = function(obj){
var keys = [];
for(var key in obj){
keys.push(key);
}
return keys.join();
}, array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray
, str = ''
;

      for (var i = 0; i < array.length; i++) {
        var line = '';
        for (var index in array[i]) {
          if(line != '') line += ','
       
          line += array[i][index];
        }

        str += line + '\r\n';
      }

      str = getKeys(objArray[0]) + '\r\n' + str;
      //console.log(str);

      var a = document.createElement('a');
      var blob = new Blob([str], {'type':'application\/octet-stream'});
      a.href = window.URL.createObjectURL(blob);
      a.download = 'stores.csv';
      a.click();
      return true;
    }

        // Example
        $(document).ready(function () {
           var loc = [];  //object
           //console.log(typeof(loc));
           
var increment = (function () {
    var n = -10;
    return function () {
        n += 10;
        return n;
    }
}());

     (function store(){
      var stores = [];

 var  x = increment();   
console.log(x);
        $.ajax({url: 'https://www.paxvapor.com/locator/index/getstores/',
            data: {lat:32, lng:118, count: x},
              success: function(result){
                if (result.length != 0){
var stores = JSON.parse(result);
//console.log("result is", typeof(result)); //result is a string
//console.log("stores is", Array.isArray([stores])); // stores is an array object
//var loc = loc.concat(stores);
console.log(JSON.stringify(loc));

$('#div1').html(JSON.stringify(loc));

Json2CSV(loc);
//store();
}
        }});
        //datatype: 'jsonp';

    }());
            // Create Object
           // var items = [{"id":"8866","salesforce_id":null,"name":"Salpat Inc","addr1":"Po Box 836","addr2":"","city":"Hagatna","state":"GU","zip":"96932","country":"US","geoaddr":"US Army Recruiting Office Agana Heights, Tutuhan, GU 96910, USA","lat":"13.4708908","lng":"144.7512782","active_location":"1","store_number":null,"carries_pax":"1","carries_m2":"0","tobacco_license":"0","phone":"6716464051","carries_juul":"0","carries_era":"0","distance":"2120.9880257338596"}]

            // Convert Object to JSON
            var jsonObject = JSON.parse(loc);

            alert(loc);

            // Display JSON
            $('#json').text(jsonObject);
//Json2CSV(items);

            // Convert JSON to CSV & Display CSV
            //$('#csv').text(ConvertToCSV(jsonObject));
            // Json2CSV(items);
        });
    </script>
</head>
<body>
    <h1>
        JSON</h1>
    <pre id="json"></pre>
    <h1>
        JSON response</h1>
    <pre id="div1"></pre>
</body>
</html>